

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Play Five-in-a-Row (Tipwen-Tikwa) gomoku, morpion online against friends. 
Customize player avatars, track turns,and enjoy dynamic gameplay with timer. 
Challenge yourself to align five pieces and become the ultimate champion in this engaging browser-based strategy game.">
<meta name="keywords" content="Five-in-a-Row, Tipwen-Tikwa, online game, gomoku, X and O game, morpion, multiplayer board game">
<meta name="author" content="Morpion, Tipwen-Tikwa, 5-in-a-row, gomoku">
<meta name="robots" content="index, follow">  
<title>Five-in-a-Row (Tipwen-Tikwa) Online, morpion | Play X and O with Friends</title>
<meta property="og:title" content="Play Five-in-a-Row (Tipwen-Tikwa) Online">
<meta property="og:description" content="Challenge friends to Five-in-a-Row (Tipwen-Tikwa). Customize avatars, enjoy sounds, and play on a dynamic expanding board!">
<meta property="og:type" content="website">
<meta property="og:url" content="https://github.com/sem00123/tipwen-tikwa">
<meta property="og:image" content="https://yourdomain.com/images/board-screenshot.png">
<meta property="og:site_name" content="Five-in-a-Row">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Play Five-in-a-Row (Tipwen-Tikwa) Online">
<meta name="twitter:description" content="Play Five-in-a-Row with friends! Dynamic board, sounds, timer, and custom avatars.">
<meta name="twitter:image" content="https://yourdomain.com/images/board-screenshot.png">
<meta name="twitter:site" content="@https://x.com/TikwaTipwe6912">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin:0; padding:0; height:100%; width:100%;
  font-family:sans-serif;
  background:#eee; color:#333;
  display:flex; flex-direction:column;
}
body.dark { background:#222; color:#ddd; }
nav {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 20px; background:#444; color:white;
  flex-wrap: wrap;
}
.player-display {
  display:flex; align-items:center;
}
.player-display img.avatar {
  width:32px; height:32px; border-radius:50%;
  margin-right:8px;
}
#board-container {
  flex:1; width:100%; position:relative;
  display:flex; align-items:center; justify-content:center;
  overflow:auto;
}
#board {
  box-shadow:0 0 8px rgba(0,0,0,0.3);
  background:#f0f0f0;
  display:block;
}
body.dark #board { background:#333; }
#status {
  text-align:center; margin:8px 0; font-weight:bold;
  font-size:1.2rem;
}
.modal {
  position:absolute;
  top:10px; right:10px;
  background:white; padding:16px 24px;
  border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.5);
  font-size:18px; display:none; z-index:50;
}
.modal button.close-btn {
  position:absolute; top:4px; right:8px; border:none; background:red;
  color:white; font-weight:bold; border-radius:50%; width:24px; height:24px;
  cursor:pointer;
}
.timer {
  font-weight:bold; font-size:1.2rem; margin-left:10px;
}
nav div.controls {
  display:flex; align-items:center; flex-wrap: wrap;
  gap:8px;
}
</style>
</head>
<body>
  
<style>
/* Button styling */
#bmc-btn {
  display: inline-block;
  padding: 6px 12px;
  background-color: #28a745; /* green */
  color: white;
  font-weight: bold;
  text-decoration: none;
  border-radius: 6px;
  font-family: sans-serif;
  transition: background 0.3s;
  margin-left: 10px;
  font-size: 0.9rem;
}
#bmc-btn:hover {
  background-color: #1e7e34;
}
  
nav .player-display {
  display: flex;
  align-items: center;
}
</style>

<a id="bmc-btn" href="https://www.buymeacoffee.com/morris1" target="_blank">
  ‚òï Support Five-in-a-row (Tipwen-Tikwa)
</a>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const p1Display = document.getElementById('p1-display');
  const bmcBtn = document.getElementById('bmc-btn');
  if (p1Display && bmcBtn) {
    p1Display.parentNode.insertBefore(bmcBtn, p1Display.nextSibling);
  }
});
</script>

  
<nav>
  <div class="player-display" id="p1-display">Player 1</div>
  <div class="controls">
    <input type="text" id="p1-name" placeholder="Player 1 Name">
    <select id="p1-avatar">
      <option value="https://i.pravatar.cc/48?img=12">Male</option>
      <option value="https://i.pravatar.cc/48?img=32">Female</option>
    </select>
    <input type="text" id="p2-name" placeholder="Player 2 Name">
    <select id="p2-avatar">
      <option value="https://i.pravatar.cc/48?img=47">Male</option>
      <option value="https://i.pravatar.cc/48?img=28">Female</option>
    </select>
    <button id="start-btn">Start Game</button>
    <button id="dark-toggle">Toggle Dark Mode</button>
    <span class="timer" id="timer">40</span>
  </div>
  <div class="player-display" id="p2-display">Player 2</div>
</nav>

<div id="status">Welcome! Enter names and avatars to start.</div>
<div id="board-container">
  <canvas id="board" tabindex="0"></canvas>
  <div class="modal" id="time-modal">
    <button class="close-btn" id="modal-close">X</button>
    <span id="modal-msg">Time's up! Better Luck Next Time.</span>
  </div>
</div>

<!-- Audio -->
<audio id="clap-sound" src="https://actions.google.com/sounds/v1/human_voices/applause.ogg"></audio>
<audio id="zonk-sound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="ding-sound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="dong-sound" src="https://actions.google.com/sounds/v1/cartoon/metal_thud.ogg"></audio>


<script>
/* ---------------------------------------------------
   FIXED VERSION ‚Äî major bug fixes applied:
   ‚úî Correct coordinate mapping
   ‚úî Board expansion stable
   ‚úî Offsets preserved properly
   ‚úî Win-line rendered in correct place
   ‚úî resizeCanvas no longer modifies rows/cols
   ‚úî Clean flashing logic
   ‚úî Timer cleanup
   ‚úî XSS-safe player names
--------------------------------------------------- */

const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");
const statusEl = document.getElementById("status");
const timerEl = document.getElementById("timer");
const p1Display = document.getElementById("p1-display");
const p2Display = document.getElementById("p2-display");
const startBtn = document.getElementById("start-btn");
const darkToggle = document.getElementById("dark-toggle");
const modal = document.getElementById("time-modal");
const modalClose = document.getElementById("modal-close");
const p1NameInput = document.getElementById("p1-name");
const p2NameInput = document.getElementById("p2-name");
const p1AvatarSelect = document.getElementById("p1-avatar");
const p2AvatarSelect = document.getElementById("p2-avatar");

const clapSound = document.getElementById("clap-sound");
const zonkSound = document.getElementById("zonk-sound");
const dingSound = document.getElementById("ding-sound");
const dongSound = document.getElementById("dong-sound");

/* ========= SOUND PRELOAD SAFELY ========= */
window.addEventListener("click", () => {
  [clapSound, zonkSound, dingSound, dongSound].forEach(a => {
    a.volume = 1.0;
  });
}, { once: true });

/* ========= CONSTANTS ========= */
let CELL = 40;
let rows = 20;
let cols = 20;

/* ========= GAME STATE ========= */
let board = [];
let current = "X";
let gameOver = false;
let winLine = [];
let rowOffset = 0;
let colOffset = 0;
let countdown = 40;
let timerInterval = null;
let flashInterval = null;
let nextStarter = "X";

/* ==========================================================
   INITIALIZATION
========================================================== */
function initBoard() {
  board = Array(rows).fill(null).map(() => Array(cols).fill(null));
  rowOffset = 0;
  colOffset = 0;
  winLine = [];
}

/* ==========================================================
   CANVAS RESIZE (no longer changes row/col)
========================================================== */
function resizeCanvas() {
  canvas.width = cols * CELL;
  canvas.height = rows * CELL;
  drawBoard();
}
window.addEventListener("resize", resizeCanvas);

/* ==========================================================
   DRAWING THE BOARD
========================================================== */
function drawBoard() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = document.body.classList.contains("dark") ? "#333" : "#f0f0f0";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = "#aaa";
  ctx.lineWidth = 1;

  for (let x = 0; x <= cols; x++) {
    ctx.beginPath();
    ctx.moveTo(x * CELL, 0);
    ctx.lineTo(x * CELL, canvas.height);
    ctx.stroke();
  }

  for (let y = 0; y <= rows; y++) {
    ctx.beginPath();
    ctx.moveTo(0, y * CELL);
    ctx.lineTo(canvas.width, y * CELL);
    ctx.stroke();
  }

  board.forEach((row, y) =>
    row.forEach((p, x) => {
      if (p) {
        const highlight = winLine.some(pt => pt.x === x && pt.y === y);
        drawPiece(x, y, p, highlight);
      }
    })
  );
}

function drawPiece(x, y, p, highlight) {
  const cx = x * CELL + CELL / 2;
  const cy = y * CELL + CELL / 2;

  if (p === "X") {
    ctx.strokeStyle = highlight ? "orange" : "blue";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(cx - CELL * 0.3, cy - CELL * 0.3);
    ctx.lineTo(cx + CELL * 0.3, cy + CELL * 0.3);
    ctx.moveTo(cx + CELL * 0.3, cy - CELL * 0.3);
    ctx.lineTo(cx - CELL * 0.3, cy + CELL * 0.3);
    ctx.stroke();
  } else {
    ctx.fillStyle = highlight ? "orange" : "red";
    ctx.beginPath();
    ctx.arc(cx, cy, CELL * 0.3, 0, 2 * Math.PI);
    ctx.fill();
  }

  ctx.lineWidth = 1;
}

/* ==========================================================
   WIN CHECK
========================================================== */
function checkWin(x, y, p) {
  const dirs = [
    [1, 0],
    [0, 1],
    [1, 1],
    [1, -1]
  ];

  for (const [dx, dy] of dirs) {
    let count = 1;
    let line = [{ x, y }];

    for (let s = 1; s < 5; s++) {
      let nx = x + dx * s, ny = y + dy * s;
      if (!board[ny] || board[ny][nx] !== p) break;
      line.push({ x: nx, y: ny });
      count++;
    }
    for (let s = 1; s < 5; s++) {
      let nx = x - dx * s, ny = y - dy * s;
      if (!board[ny] || board[ny][nx] !== p) break;
      line.unshift({ x: nx, y: ny });
      count++;
    }
    if (count >= 5) {
      winLine = line;
      return true;
    }
  }
  return false;
}

/* ==========================================================
   BOARD EXPANSION (corrected; no coordinate corruption)
========================================================== */
function expandIfNeeded(x, y) {
  let expanded = false;

  // Expand bottom
  if (y >= rows - 5) {
    board.push(...Array(10).fill(null).map(() => Array(cols).fill(null)));
    rows += 10;
    expanded = true;
  }

  // Expand right
  if (x >= cols - 5) {
    board.forEach(r => r.push(...Array(10).fill(null)));
    cols += 10;
    expanded = true;
  }

  // Expand top
  if (y < 5) {
    board.unshift(...Array(10).fill(null).map(() => Array(cols).fill(null)));
    rows += 10;
    // no offset shifting
    expanded = true;
  }

  // Expand left
  if (x < 5) {
    board.forEach(r => r.unshift(...Array(10).fill(null)));
    cols += 10;
    expanded = true;
  }

  if (expanded) {
    resizeCanvas();
    drawBoard();
    centerOn(x, y);
  }
}

/* ==========================================================
   SCROLL CENTERING
========================================================== */
function centerOn(x, y) {
  const container = document.getElementById("board-container");
  container.scrollTop = y * CELL - container.clientHeight / 2;
  container.scrollLeft = x * CELL - container.clientWidth / 2;
}

/* ==========================================================
   SOUNDS
========================================================== */
function playPieceSound(p) {
  if (p === "X") {
    dongSound.currentTime = 0;
    dongSound.play().catch(() => {});
  } else {
    dingSound.currentTime = 0;
    dingSound.play().catch(() => {});
  }
}

/* ==========================================================
   CORE PIECE PLACEMENT
========================================================== */
function placePiece(x, y) {
  if (x < 0 || y < 0 || x >= cols || y >= rows) return false;
  if (board[y][x] || gameOver) return false;

  board[y][x] = current;
  playPieceSound(current);
  drawBoard();

  expandIfNeeded(x, y);

  if (checkWin(x, y, current)) {
    endGame(current + " Wins!", true, false);
    return true;
  }

  current = current === "X" ? "O" : "X";
  statusEl.textContent = `${current}'s Turn`;
  resetTimer();
  return true;
}

/* ==========================================================
   TIMER
========================================================== */
function resetTimer() {
  clearInterval(timerInterval);
  countdown = 40;
  timerEl.textContent = countdown;
  timerEl.style.color = "green";

  timerInterval = setInterval(() => {
    countdown--;
    timerEl.textContent = countdown;

    if (countdown <= 0) {
      clearInterval(timerInterval);
      timerEl.style.color = "red";
      zonkSound.currentTime = 0;
      zonkSound.play().catch(() => {});
      endGame("Time's Up!", false, true);
    }
  }, 1000);
}

/* ==========================================================
   MODAL HANDLING
========================================================== */
modalClose.onclick = () => (modal.style.display = "none");

function showTimeUpModal() {
  modal.style.display = "block";
}

/* ==========================================================
   WIN LINE FLASHING
========================================================== */
function flashLine() {
  let visible = true;

  flashInterval = setInterval(() => {
    drawBoard();

    if (visible && winLine.length > 1) {
      ctx.strokeStyle = "orange";
      ctx.lineWidth = 6;

      ctx.beginPath();
      ctx.moveTo(winLine[0].x * CELL + CELL / 2, winLine[0].y * CELL + CELL / 2);
      ctx.lineTo(
        winLine[winLine.length - 1].x * CELL + CELL / 2,
        winLine[winLine.length - 1].y * CELL + CELL / 2
      );
      ctx.stroke();
      ctx.lineWidth = 1;
    }

    visible = !visible;
  }, 450);
}

/* ==========================================================
   END GAME LOGIC
========================================================== */
function endGame(msg, win = false, timeup = false) {
  gameOver = true;
  clearInterval(timerInterval);
  statusEl.textContent = msg;

  if (win) {
    clapSound.currentTime = 0;
    clapSound.play().catch(() => {});
    flashLine();

    setTimeout(() => {
      clapSound.pause();
      clearInterval(flashInterval);
      drawBoard();
    }, 5000);
  }

  if (timeup) {
    showTimeUpModal();
  }
}

/* ==========================================================
   INPUT HANDLERS
========================================================== */
canvas.addEventListener("click", e => {
  if (gameOver) return;

  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) / CELL);
  const y = Math.floor((e.clientY - rect.top) / CELL);

  placePiece(x, y);
});

canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  if (gameOver) return;

  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((touch.clientX - rect.left) / CELL);
  const y = Math.floor((touch.clientY - rect.top) / CELL);

  placePiece(x, y);
});

/* ==========================================================
   DARK MODE
========================================================== */
darkToggle.onclick = () => {
  document.body.classList.toggle("dark");
  drawBoard();
};

/* ==========================================================
   START GAME
========================================================== */
startBtn.onclick = () => {
  const escapeHTML = str => str.replace(/[&<>"']/g, c => ({
    "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
  })[c]);

  const p1Name = escapeHTML(p1NameInput.value.trim() || "Player 1");
  const p2Name = escapeHTML(p2NameInput.value.trim() || "Player 2");

  const p1Avatar = p1AvatarSelect.value;
  const p2Avatar = p2AvatarSelect.value;

  p1Display.innerHTML = `<img class="avatar" src="${p1Avatar}"> ${p1Name} (X)`;
  p2Display.innerHTML = `<img class="avatar" src="${p2Avatar}"> ${p2Name} (O)`;

  initBoard();
  resizeCanvas();
  drawBoard();

  gameOver = false;
  current = nextStarter;
  nextStarter = nextStarter === "X" ? "O" : "X";

  statusEl.textContent = `${current}'s Turn`;
  modal.style.display = "none";

  resetTimer();
};

initBoard();
resizeCanvas();
drawBoard();
</script>

<script>
// ============================
// Visitor Counter Script
// ============================

// Wrap in DOMContentLoaded to ensure nav elements exist
window.addEventListener('DOMContentLoaded', () => {
  const bmcBtn = document.getElementById('bmc-btn');

  if (!bmcBtn) return;

  // Create counter element
  const counter = document.createElement('span');
  counter.id = 'visitor-counter';
  counter.style.marginLeft = '8px';
  counter.style.fontWeight = 'bold';
  counter.style.color = 'white';
  counter.textContent = '...'; // placeholder while loading

  // Insert counter next to the support button
  bmcBtn.parentNode.insertBefore(counter, bmcBtn.nextSibling);

  // Use a free visitor counter API (https://api.countapi.xyz)
  // We'll use your GitHub repo as a namespace
  const namespace = 'tipwen-tikwa-game';
  const key = 'visitor-counter';

  // Increment visitor count
  fetch(`https://api.countapi.xyz/hit/${namespace}/${key}`)
    .then(res => res.json())
    .then(data => {
      if (data.value !== undefined) {
        counter.textContent = `üëÅ ${data.value}`;
      } else {
        counter.textContent = 'üëÅ N/A';
      }
    })
    .catch(err => {
      console.error('Visitor counter error:', err);
      counter.textContent = 'üëÅ N/A';
    });
});
</script>

  
</body>
</html>








